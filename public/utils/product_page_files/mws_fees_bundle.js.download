(()=>{var t,e,r={70:(t,e,r)=>{var a="__lodash_hash_undefined__",i=9007199254740991,n="[object Arguments]",c="[object Function]",o="[object GeneratorFunction]",s=/^\[object .+?Constructor\]$/,l="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,d="object"==typeof self&&self&&self.Object===Object&&self,p=l||d||Function("return this")();function _(t,e){return!!(t?t.length:0)&&function(t,e,r){if(e!=e)return function(t,e,r,a){var i=t.length,n=r+(a?1:-1);for(;a?n--:++n<i;)if(e(t[n],n,t))return n;return-1}(t,m,r);var a=r-1,i=t.length;for(;++a<i;)if(t[a]===e)return a;return-1}(t,e,0)>-1}function u(t,e,r){for(var a=-1,i=t?t.length:0;++a<i;)if(r(e,t[a]))return!0;return!1}function f(t,e){for(var r=-1,a=e.length,i=t.length;++r<a;)t[i+r]=e[r];return t}function m(t){return t!=t}function h(t,e){return t.has(e)}var v,y=Array.prototype,g=Function.prototype,w=Object.prototype,b=p["__core-js_shared__"],C=(v=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+v:"",E=g.toString,x=w.hasOwnProperty,T=w.toString,j=RegExp("^"+E.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),k=p.Symbol,O=w.propertyIsEnumerable,P=y.splice,A=k?k.isConcatSpreadable:void 0,L=Math.max,I=W(p,"Map"),S=W(Object,"create");function D(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function N(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function R(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function F(t){var e=-1,r=t?t.length:0;for(this.__data__=new R;++e<r;)this.add(t[e])}function q(t,e){for(var r,a,i=t.length;i--;)if((r=t[i][0])===(a=e)||r!=r&&a!=a)return i;return-1}function M(t,e,r,a){var i,n=-1,c=_,o=!0,s=t.length,l=[],d=e.length;if(!s)return l;r&&(e=function(t,e){for(var r=-1,a=t?t.length:0,i=Array(a);++r<a;)i[r]=e(t[r],r,t);return i}(e,(i=r,function(t){return i(t)}))),a?(c=u,o=!1):e.length>=200&&(c=h,o=!1,e=new F(e));t:for(;++n<s;){var p=t[n],f=r?r(p):p;if(p=a||0!==p?p:0,o&&f==f){for(var m=d;m--;)if(e[m]===f)continue t;l.push(p)}else c(e,f,a)||l.push(p)}return l}function H(t,e,r,a,i){var n=-1,c=t.length;for(r||(r=Q),i||(i=[]);++n<c;){var o=t[n];e>0&&r(o)?e>1?H(o,e-1,r,a,i):f(i,o):a||(i[i.length]=o)}return i}function U(t){if(!K(t)||(e=t,C&&C in e))return!1;var e,r=Y(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?j:s;return r.test(function(t){if(null!=t){try{return E.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function B(t,e){var r,a,i=t.__data__;return("string"==(a=typeof(r=e))||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function W(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return U(r)?r:void 0}function Q(t){return V(t)||function(t){return J(t)&&x.call(t,"callee")&&(!O.call(t,"callee")||T.call(t)==n)}(t)||!!(A&&t&&t[A])}D.prototype.clear=function(){this.__data__=S?S(null):{}},D.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},D.prototype.get=function(t){var e=this.__data__;if(S){var r=e[t];return r===a?void 0:r}return x.call(e,t)?e[t]:void 0},D.prototype.has=function(t){var e=this.__data__;return S?void 0!==e[t]:x.call(e,t)},D.prototype.set=function(t,e){return this.__data__[t]=S&&void 0===e?a:e,this},N.prototype.clear=function(){this.__data__=[]},N.prototype.delete=function(t){var e=this.__data__,r=q(e,t);return!(r<0)&&(r==e.length-1?e.pop():P.call(e,r,1),!0)},N.prototype.get=function(t){var e=this.__data__,r=q(e,t);return r<0?void 0:e[r][1]},N.prototype.has=function(t){return q(this.__data__,t)>-1},N.prototype.set=function(t,e){var r=this.__data__,a=q(r,t);return a<0?r.push([t,e]):r[a][1]=e,this},R.prototype.clear=function(){this.__data__={hash:new D,map:new(I||N),string:new D}},R.prototype.delete=function(t){return B(this,t).delete(t)},R.prototype.get=function(t){return B(this,t).get(t)},R.prototype.has=function(t){return B(this,t).has(t)},R.prototype.set=function(t,e){return B(this,t).set(t,e),this},F.prototype.add=F.prototype.push=function(t){return this.__data__.set(t,a),this},F.prototype.has=function(t){return this.__data__.has(t)};var G,X,$=(G=function(t,e){return J(t)?M(t,H(e,1,J,!0)):[]},X=L(void 0===X?G.length-1:X,0),function(){for(var t=arguments,e=-1,r=L(t.length-X,0),a=Array(r);++e<r;)a[e]=t[X+e];e=-1;for(var i=Array(X+1);++e<X;)i[e]=t[e];return i[X]=a,function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(G,this,i)});var V=Array.isArray;function z(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}(t.length)&&!Y(t)}function J(t){return function(t){return!!t&&"object"==typeof t}(t)&&z(t)}function Y(t){var e=K(t)?T.call(t):"";return e==c||e==o}function K(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=$},562:(t,e,r)=>{var a="__lodash_hash_undefined__",i=9007199254740991,n="[object Function]",c="[object GeneratorFunction]",o=/^\[object .+?Constructor\]$/,s="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,l="object"==typeof self&&self&&self.Object===Object&&self,d=s||l||Function("return this")();function p(t,e){return!!(t?t.length:0)&&function(t,e,r){if(e!=e)return function(t,e,r,a){var i=t.length,n=r+(a?1:-1);for(;a?n--:++n<i;)if(e(t[n],n,t))return n;return-1}(t,f,r);var a=r-1,i=t.length;for(;++a<i;)if(t[a]===e)return a;return-1}(t,e,0)>-1}function _(t,e,r){for(var a=-1,i=t?t.length:0;++a<i;)if(r(e,t[a]))return!0;return!1}function u(t,e){for(var r=-1,a=t?t.length:0,i=Array(a);++r<a;)i[r]=e(t[r],r,t);return i}function f(t){return t!=t}function m(t){return function(e){return t(e)}}function h(t,e){return t.has(e)}var v,y=Array.prototype,g=Function.prototype,w=Object.prototype,b=d["__core-js_shared__"],C=(v=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+v:"",E=g.toString,x=w.hasOwnProperty,T=w.toString,j=RegExp("^"+E.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),k=y.splice,O=Math.max,P=Math.min,A=H(d,"Map"),L=H(Object,"create");function I(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function S(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function D(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var a=t[e];this.set(a[0],a[1])}}function N(t){var e=-1,r=t?t.length:0;for(this.__data__=new D;++e<r;)this.add(t[e])}function R(t,e){for(var r,a,i=t.length;i--;)if((r=t[i][0])===(a=e)||r!=r&&a!=a)return i;return-1}function F(t){if(!G(t)||(e=t,C&&C in e))return!1;var e,r=Q(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?j:o;return r.test(function(t){if(null!=t){try{return E.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function q(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}(t.length)&&!Q(t)}(t)}(t)?t:[]}function M(t,e){var r,a,i=t.__data__;return("string"==(a=typeof(r=e))||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==r:null===r)?i["string"==typeof e?"string":"hash"]:i.map}function H(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return F(r)?r:void 0}I.prototype.clear=function(){this.__data__=L?L(null):{}},I.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},I.prototype.get=function(t){var e=this.__data__;if(L){var r=e[t];return r===a?void 0:r}return x.call(e,t)?e[t]:void 0},I.prototype.has=function(t){var e=this.__data__;return L?void 0!==e[t]:x.call(e,t)},I.prototype.set=function(t,e){return this.__data__[t]=L&&void 0===e?a:e,this},S.prototype.clear=function(){this.__data__=[]},S.prototype.delete=function(t){var e=this.__data__,r=R(e,t);return!(r<0)&&(r==e.length-1?e.pop():k.call(e,r,1),!0)},S.prototype.get=function(t){var e=this.__data__,r=R(e,t);return r<0?void 0:e[r][1]},S.prototype.has=function(t){return R(this.__data__,t)>-1},S.prototype.set=function(t,e){var r=this.__data__,a=R(r,t);return a<0?r.push([t,e]):r[a][1]=e,this},D.prototype.clear=function(){this.__data__={hash:new I,map:new(A||S),string:new I}},D.prototype.delete=function(t){return M(this,t).delete(t)},D.prototype.get=function(t){return M(this,t).get(t)},D.prototype.has=function(t){return M(this,t).has(t)},D.prototype.set=function(t,e){return M(this,t).set(t,e),this},N.prototype.add=N.prototype.push=function(t){return this.__data__.set(t,a),this},N.prototype.has=function(t){return this.__data__.has(t)};var U,B,W=(U=function(t){var e=u(t,q);return e.length&&e[0]===t[0]?function(t,e,r){for(var a=r?_:p,i=t[0].length,n=t.length,c=n,o=Array(n),s=1/0,l=[];c--;){var d=t[c];c&&e&&(d=u(d,m(e))),s=P(d.length,s),o[c]=!r&&(e||i>=120&&d.length>=120)?new N(c&&d):void 0}d=t[0];var f=-1,v=o[0];t:for(;++f<i&&l.length<s;){var y=d[f],g=e?e(y):y;if(y=r||0!==y?y:0,!(v?h(v,g):a(l,g,r))){for(c=n;--c;){var w=o[c];if(!(w?h(w,g):a(t[c],g,r)))continue t}v&&v.push(g),l.push(y)}}return l}(e):[]},B=O(void 0===B?U.length-1:B,0),function(){for(var t=arguments,e=-1,r=O(t.length-B,0),a=Array(r);++e<r;)a[e]=t[B+e];e=-1;for(var i=Array(B+1);++e<B;)i[e]=t[e];return i[B]=a,function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(U,this,i)});function Q(t){var e=G(t)?T.call(t):"";return e==n||e==c}function G(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=W}},a={};function i(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={exports:{}};return r[t](n,n.exports,i),n.exports}i.m=r,i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,r)=>(i.f[r](t,e),e)),[])),i.u=t=>t+".mws_fees_bundle.js",i.miniCssF=t=>"mws_fees_bundle.css",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="product-fees-front:",i.l=(r,a,n,c)=>{if(t[r])t[r].push(a);else{var o,s;if(void 0!==n)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var p=l[d];if(p.getAttribute("src")==r||p.getAttribute("data-webpack")==e+n){o=p;break}}o||(s=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.setAttribute("data-webpack",e+n),o.src=r),t[r]=[a];var _=(e,a)=>{o.onerror=o.onload=null,clearTimeout(u);var i=t[r];if(delete t[r],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach((t=>t(a))),e)return e(a)},u=setTimeout(_.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=_.bind(null,o.onerror),o.onload=_.bind(null,o.onload),s&&document.head.appendChild(o)}},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&!t;)t=r[a--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{var t={296:0};i.f.j=(e,r)=>{var a=i.o(t,e)?t[e]:void 0;if(0!==a)if(a)r.push(a[2]);else{var n=new Promise(((r,i)=>a=t[e]=[r,i]));r.push(a[2]=n);var c=i.p+i.u(e),o=new Error;i.l(c,(r=>{if(i.o(t,e)&&(0!==(a=t[e])&&(t[e]=void 0),a)){var n=r&&("load"===r.type?"missing":r.type),c=r&&r.target&&r.target.src;o.message="Loading chunk "+e+" failed.\n("+n+": "+c+")",o.name="ChunkLoadError",o.type=n,o.request=c,a[1](o)}}),"chunk-"+e,e)}};var e=(e,r)=>{var a,n,[c,o,s]=r,l=0;if(c.some((e=>0!==t[e]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(s)s(i)}for(e&&e(r);l<c.length;l++)n=c[l],i.o(t,n)&&t[n]&&t[n][0](),t[n]=0},r=self.webpackChunkproduct_fees_front=self.webpackChunkproduct_fees_front||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})(),(()=>{"use strict";var t="_mws_fee",e=window.Shopify.routes.root?window.Shopify.routes.root:"/",r="".concat(window.location.origin).concat(e),a="Order & Product Fees",n=""===r?"/":r,c="".concat("https://fees-next-admin.mageworx.com/front","/"),o=["JPY","CLP","HUF","ISK","KRW","MNT","PYG","RWF","UGX","VND","XPF","ZMW"],s=window.mwFeesConfig.money_format;function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;"string"==typeof t&&(t=t.replace(".",""));var r="",a=/\{\{\s*(\w+)\s*\}\}/,i=e||s;function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:",",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".";if(isNaN(t)||null==t)return 0;var i=(t=(t/100).toFixed(e)).split(".");return i[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1".concat(r))+(i[1]?a+i[1]:"")}switch(i.match(a)[1]){case"amount":r=n(t,2);break;case"amount_no_decimals":r=n(t,0);break;case"amount_with_comma_separator":r=n(t,2,".",",");break;case"amount_no_decimals_with_comma_separator":r=n(t,0,".",",");break;case"amount_with_apostrophe_separator":r=n(t,2,"'",".");break;case"amount_no_decimals_with_space_separator":r=n(t,0," ","");break;case"amount_with_space_separator":r=n(t,2," ",",");break;case"amount_with_period_and_space_separator":r=n(t,2," ",".")}return i.replace(a,r)}var d=function(t){for(var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=3735928559^r,i=1103547991^r,n=0;n<t.length;n++)e=t.charCodeAt(n),a=Math.imul(a^e,2654435761),i=Math.imul(i^e,1597334677);return a=Math.imul(a^a>>>16,2246822507),a^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),4294967296*(2097151&(i^=Math.imul(a^a>>>13,3266489909)))+(a>>>0)},p=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))};function _(e){var r=0,a=0,i=0,n=e.items_subtotal_price===e.original_total_price?0:e.total_discount,c=e.items.filter((e=>!e.properties||void 0===e.properties[t]||(r+=e.price*e.quantity,a+=e.quantity,i+=e.grams,!1)));return Object.assign(Object.assign({},e),{items:c,total_price:e.original_total_price-r-n,item_count:e.item_count-a,total_weight:e.total_weight-i})}function u(t){var{fee_type:e,option_price:r,shop_currency:a,target_price:i,total_price:n}=t,c=0;return"PRODUCT"===e&&i&&(c=i/100*(r/100)),"CART"===e&&n&&(c=n/100*(r/100)),o.includes(a)&&(c=Math.round(c)),parseFloat(c.toFixed(2))}function f(t){var{fee_type:e,fee_is_onetime:r,option_price_type:a,option_price:i,step_percent_value:n,clean_cart:c,clone_percent_fee:o,shop_currency:s,target_key:l}=t,d=1,p=c.items.filter((t=>h(t)===l));if(l&&!p.length)return 0;if("PERCENT"===a&&!o){var _=u({fee_type:e,option_price:i,shop_currency:s,total_price:c.total_price,target_price:p.length?p[0].price:void 0});if(0===_)return _;var f=Math.round(_/n)||Math.ceil(_/n),m=Math.floor(_/n),v=f*n,y=m*n;d=(d=Math.abs(_-v)<=Math.abs(_-y)?f:m)||1}var g=p.length&&p[0].quantity?p[0].quantity:1;return d=r||"CART"===e?d:d*g,Math.ceil(d)}function m(t){return p(this,void 0,void 0,(function*(){var e=yield fetch("".concat(n,"services/currency/update?currency=").concat(t,"&return_to=%2Fcart.json"));return yield e.json()}))}function h(t){var e=JSON.stringify([t.variant_id,t.product_id,t.properties]);return d(e).toString()}var v,y={lineItem:["[data-fee-line-item]",".has-popup-tab .popup-tab .detail .item","#main #cartform .cart-list .item",".topBar__miniCart #mini_cart_form .cart_items .miniCart__item","#cart_form .container .cart__itemList .cart__card",".cart-mini-sidebar .cart-mini-content .cart-mini-item",".template-cart .section-cart .cart .cart-table tbody .table-row",".container.clearfix > div .twelve .twelve .cart-table.bottompad .item-row","#header-cart .mini-products-list:first-child .grid",".cart .grid table tbody tr.cart__row",".recently-added table tbody tr",".custom .row .columns .cart-table tbody tr",".cart-summary .cart-summary__product:first-child","form .cart-items .cart-item-container","#CartForm #CartOuter table tbody .item","#your-shopping-cart .page-container .main-content .items > .item:not(:last-child)","#cart-summary .inner .cart-summary-item-list .cart-summary-item","#cartform .cart-items .item",".cart-form .cart-content > div .cart-item-wrapper .cart-item",".ajaxcart .max-width--4 .cart .cart__row.mt3 .grid:first-child","form .cart .cart__row:nth-child(2) .grid:first-child",".ajaxcart .items .item",".cart .items .item",".cart-preview .product-container .box.product",".cart-form .cart-items .cart-item","#cart-form table tbody .cart-row",".ajaxcart .ajaxcart__inner .ajaxcart__product .ajaxcart__row",".cart .cart-table tbody .cart__row",".cart tbody .cart__row",".halo-modal-body .cart-popup-content .cart-form .scroll-content .cart_items .cart-list li","#dropdown-cart .has-items .mini-products-list .item",".cart-form .cart_items .cart-list li","#dropdown-cart .has-items .mini-products-list .item",".shopify-section form .wrapper-cart .cart-list li","#shopify-section-static-cart form .cartitems--container .cartitems .cart-item","#cartform .cart-table tbody tr.even",".standard-page form .cart-items.row",".ajaxcart .ajaxcart__inner .ajaxcart__product .ajaxcart.row","#cartform table tbody tr","#CartDrawer #CartContainer .ajaxcart .ajaxcart__product .ajaxcart__row","#your-shopping-cart #PageContainer .cart .cart-table .cart__row",".cart__form .cart__table .cart__items .cart__item",".modal-cart-form table.table-shopping-cart tbody .cart-line-item",".main-cart-form table.table-shopping-cart tbody .cart-line-item",".cart-form .cart-items tbody tr.cart-item",".site-main #shopify-section-static-cart .cart-form .cart-items .cart-item",".ajaxcart .drawer__inner .ajaxcart__product .ajaxcart__row",".cart .cart__row:nth-child(2) .grid.cart__row--table-large",".cart .ajaxcart__inner .ajaxcart__product .ajaxcart__row","form.cart .cart__row:not(.cart__header-labels)",".mini-cart .mini-cart__content .mini-cart__full .mini-cart__items .mini-cart__item","form table tbody tr","form .cart--mobile .cart__items .cart-item","#cart-form .cart-row",".cart .cart-table tbody tr.cart__row","form .cart-items-container .cart-items tbody tr.cart-item",".modal--window .modal--container form .variant-id",".template--cart .layout--main-content form .content .variant-id",".template-cart .cart .cart-items",".header-cart .header-cart-items .header-cart-item",".grid #cartForm .cartRow",".modal--container .fw--cart form .content .variant-id",".panel div form .content .variant-id",".shopify-section .reading-container #cartform ul li.item",".cart #shopify-section-cart-template  #cart_form ul li",".container-wrap .container #Cart form .cart-table #CartItems .line-item",".cartContainer .scroll #Cart form .cart-table #CartItems .line-item",".ajaxcart .ajaxcart__inner .ajaxcart__product .ajaxcart__row .grid","#shopping-cart #cartform .desktop-8.tablet-6 .cart-item","form .cart-items tbody .cart-item",".ajaxcart .ajaxcart__inner .ajaxcart__product .ajaxcart__row .grid",".cart.table-wrap .cart-table tbody .cart__row",".mm-panels .mm-opened .cart_item",".ajaxcart__content .cart__body .cart__row:not(:first-child)",".template-cart .cartForm .cart__body .cart__row:not(:first-child)",".cart-wrapper .cart-inner > div .cart-content .clearfix .item-cart",".cart div .cart-table-wrap .data-table tbody tr","#shopify-section-cart-template .cart .line-items .line-item",".static-cart-wrapper .cart .cart-container .cart-container-scrollable .cart-items .cart-item-row","#site-header-drawer-cart .cart-mini .cart-container .cart-container-scrollable .cart-items .cart-item-row","#cart_form ul li","#cart .mm-panels .mm-panel ul.mm-listview .cart_item","#cart_form .section .cart_items","#cartform .cart-list .item.clearfix",".cart_menu form .cart_row:first-child ul:last-child",".cart_tbl form .con_row ul","#site-cart .site-nav-container-last .top .cart .cart-items .cart-item",".site-box-content .cart .cart-items .cart-item","#shopify-section-template-cart form table.cart-items tbody tr.cart-item",".cartForm .cart__body .cart__row:last-child .cart__row--table-large:first-child","#cartform .cart-contents .clearfix",".template-product #cart-summary-overlay .cart-summary-overlay__column-item .cart-summary-overlay__variants","#cartform .item-list .item .desc div .name","#ajaxifyCart .cart-form .ajaxifyCart--products .ajaxifyCart--product",".cart #shopping-cart #cartform table tbody tr",".mini-cart .mini-cart__inner .mini-cart__items .mini-cart__item-wrapper .mini-cart__item",".container form .cart__items tbody tr.cart-item","#cart_form .section .columns .section.clearfix:first-child",".cart_container .cart_content form.js-cart_content__form ul.js-cart_items .cart_item ","#cartform table.desktop-9 tbody tr",".cart-form .cart__products .cart__product .cart__row",".ajaxcart__form .ajaxcart__inner .ajaxcart__products .ajaxcart__product .ajaxcart__row",".container-widget .shopping-cart-table tbody tr"],lineItemProperties:["[data-fee-line-item-properties]",".cart-popup-wrapper .cart-popup-item .product-details .product-details__item",".cart .cart__row .cart__meta .product-details .product-details__item",".has-popup-tab .popup-tab .detail .item .detail .variant","#main #cartform .cart-list .item .col-desc .text .title",".topBar__miniCart #mini_cart_form .cart_items .miniCart__item .miniCart__itemDetails","#cart_form .container .cart__itemList .cart__card .cart__info .cart__text .meta",".cart-mini-sidebar .cart-mini-content .cart-mini-item .cart-mini-item-row .cart-mini-item-variant",".template-cart .section-cart .cart .cart-table tbody .table-row .product-item .variant",".container.clearfix > div .twelve .twelve .cart-table.bottompad .item-row .item-details .three h6",".cart .grid table tbody td.cart__meta .list-view-item__title",".block-cart .mini-products-list:first-child .grid .product-details .pName",".recently-added table tbody tr .cart-detail h2",".custom .row .columns .cart-table tbody tr .title p",".cart-summary .cart-summary__product:first-child .cart-summary__product__description .cart-summary__product__variants","form .cart-items .description .description__variant:last-child","#CartForm #CartOuter table tbody .item .desc a","#your-shopping-cart .page-container .main-content .item .product .subtitle","#cart-summary .inner .cart-summary-item-list .cart-summary-item .title-variant .variant","#cartform .cart-items .item .description .variant",".cart-form .cart-content > div .cart-item-wrapper .cart-item .cart-item-info-wrapper .cart-item-options ul li:nth-last-child(2)",".ajaxcart .max-width--4 .cart .cart__row.mt3 .grid:last-child .grid__item.three-quarters .pl2 .table.full--w","form .cart .cart__row:nth-child(2) .grid:last-child .grid__item.three-quarters .pl2 .table.full--w",".ajaxcart .items .item .right .description:last-child",".cart .items .item .right .description:last-child",".cart-preview .product-container .product figure figcaption",".cart-form .cart-items .cart-item .grid .cart-item-product .cart-item-title","#cart-form table tbody .cart-row .cart-detail a",".ajaxcart .ajaxcart__inner .ajaxcart__product .ajaxcart__row .grid .grid__item.grid__item.three-quarters .mb1 ",".cart .cart-table tbody .cart__row td:first-child .cart__info .product-grid-title",".halo-modal-body .cart-popup-content .cart-form .scroll-content .cart_items .cart-list li .cart-title .product-name","#dropdown-cart .has-items .mini-products-list .item .product-details .product-name",".cart-form .cart_items .cart-list li .details .cart-details .product-name",".shopify-section form .wrapper-cart .cart-list li .product-details p.size","#dropdown-cart .has-items .mini-products-list .item .product-details .product-name a","#shopify-section-static-cart form .cartitems--container .cartitems .cart-item .cart-item--inner .cart-item--content .cart-item--content-title",".atc-banner--container .atc-banner--outer .atc-banner--inner .atc-banner--product .atc--product .atc--product-details .atc--product-details--title","#cartform .cart-table tbody .cart-table-title .cart__meta-text",".standard-page form .cart-items.row > div .cart-item .cart-column--detail .cart-column--title-and-price .cart-variant",".ajaxcart .ajaxcart__inner .ajaxcart__product .ajaxcart.row .desktop-8.tablet-4 p .ajaxcart__product-meta","#cartform table tbody tr .cart-item .cart-title p","#CartDrawer #CartContainer .ajaxcart .ajaxcart__product .ajaxcart__row .ajaxcart__product-meta","#your-shopping-cart #PageContainer .cart .cart-table .cart__row td:nth-child(2) small",".cart__form .cart__table .cart__items .cart__item .cart-item__left .cart-item__title",".modal-cart-form table.table-shopping-cart tbody .cart-line-item .table-shopping-cart-img .table-shopping-cart-item",".main-cart-form table.table-shopping-cart tbody .cart-line-item .table-shopping-cart-img .table-shopping-cart-item",".cart-form .cart-items tbody tr.cart-item .product-item .product-item-details .cart-variant",".site-main #shopify-section-static-cart .cart-form .cart-items .cart-item .cart-item-column-2 .cart-item-title",".ajaxcart .drawer__inner .ajaxcart__product .ajaxcart__row .grid:first-child .grid__item.grid__item.two-thirds .ajaxcart__product-name--wrapper .ajaxcart__product-meta",".cart .cart__row:nth-child(2) .grid.cart__row--table-large .grid__item:first-child .grid .grid__item.three-quarters .cart__product-meta:first-child",".cart .ajaxcart__inner .ajaxcart__product .ajaxcart__row > div .grid__item:nth-child(2) .display-table-cell p .ajaxcart__product-title","form.cart .cart__row:nth-child(3) .grid--full.cart__row--table-large .grid__item:first-child .grid .grid__item:nth-child(2) a",".mini-cart .mini-cart__content .mini-cart__full .mini-cart__items .mini-cart__item .product-meta .product-meta__title","form table tbody tr td.cart-item__info .cart-item__variant","form .cart--mobile .cart__items .cart-item .cart-item__right .cart-item__title","#cart-form .cart-row .content > div h3",".cart .cart-table tbody tr.cart__row td:first-child .cart__info .product-grid-title","form .cart-items-container .cart-items tbody tr.cart-item .cart-item-product-wrap .cart-variant",".modal--window .modal--container form .variant-id .title a",".template--cart .layout--main-content form .content .variant-id .title a",".template-cart .cart .cart-product-info-wrapper .cart-product-info-wrapper .cart-price-wrapper + p",".header-cart .header-cart-items .header-cart-item .header-cart-item-info .header-cart-item-options span:first-child",".grid #cartForm .cartRow li:nth-child(2) a",".modal--container .fw--cart form .content .variant-id .right-column .title",".panel div form .content .variant-id .right-column .title",".shopify-section .reading-container #cartform ul li .desc .name",".cart #shopify-section-cart-template  #cart_form ul li .title_column p a",".container-wrap .container #Cart form .cart-table #CartItems .line-item .cart-product-desc a",".cartContainer .scroll #Cart form .cart-table #CartItems .line-item .cart-product-desc a",".ajaxcart .ajaxcart__inner .ajaxcart__product .ajaxcart.row .desktop-8.tablet-4 p:first-child","#shopping-cart #cartform .desktop-8.tablet-6 .cart-title h4","form .cart-items tbody .cart-item .cart-item-product .cart-item-title a",".ajaxcart .ajaxcart__inner .ajaxcart__product .ajaxcart__row .grid .grid__item:nth-child(2) p .ajaxcart__product-name",".cart.table-wrap .cart-table tbody .cart__row td:nth-child(3) a",".mm-panels .mm-opened .cart_item .item_info",".cart #content_wrapper .main #cart_form .cart_items .omega > p:first-child",".ajaxcart__content .cart__body .cart__row:not(:first-child) .cart__item__title p",".template-cart .cartForm .cart__body .cart__row .cart__item__title p",".cart-wrapper .cart-inner > div .cart-content .clearfix .item-cart .product-details .product-name",".cart div .cart-table-wrap .data-table tbody tr .product-name-td .product-name",".PageContent > .Cart > .Cart__ItemList > .CartItem > .CartItem__Info > .CartItem__Meta",".Drawer__Container .CartItem > .CartItem__Info > .CartItem__Title","#shopify-section-cart-template .cart .line-items .line-item .variant-title",".static-cart-wrapper .cart .cart-container .cart-container-scrollable .cart-items .cart-item-row .cart-item-col-product .cart-item-column-slide .cart-item-details .cart-item-product-title","#site-header-drawer-cart .cart-mini .cart-container .cart-container-scrollable .cart-items .cart-item-row .cart-item-col-product .cart-item-column-slide .cart-item-details .cart-item-product-title",".fancybox-skin > div .container .cart_notification_content p:first-child","#cart_form ul li .title_column .meta","#cart .mm-panels .mm-panel ul.mm-listview .cart_item a .item_info","#cart_form .section .cart_items .five.columns.omega p:first-child","#cartform .cart-list .item.clearfix .col-desc .text .title",".cart_menu form .cart_row ul:not(:first-child) li:nth-child(2) p",".cart_tbl form .con_row ul li:nth-child(2) p","#site-cart .site-nav-container-last .top .cart .cart-items .cart-item .content .title",".site-box-content .cart .cart-items .cart-item .content .title","#shopify-section-template-cart form table.cart-items tbody tr.cart-item .cart-item-product .cart-item-product-wrap .cart-variant",".cartForm .cart__body .cart__row:last-child .cart__row--table-large:first-child > div .cart__description__wrapper .cart__description a:first-child","#cartform .cart-contents .clearfix .cart-col2 .short-desc",".has-popup-tab .popup-tab .detail .item .detail .variant","#main #cartform .cart-list .item .col-desc .text .title","#ajaxifyCart .cart-form .ajaxifyCart--products .ajaxifyCart--product .large--two-thirds .three-quarters p",".mini-cart .mini-cart__inner .mini-cart__items .mini-cart__item-wrapper .mini-cart__item .mini-cart-item__info .mini-cart-item__variant",".container form .cart__items tbody tr.cart-item .cart-item__product .cart-item__info .cart-item__title","#cart_form > div .cart_content_info h3",".cart_container .cart_content form.js-cart_content__form .js-cart_items .cart_item .cart_item__title a","#cartform table.desktop-9 tbody tr td .cart-item .cart-title p:last-child",".ajaxcart__form .ajaxcart__inner .ajaxcart__products .ajaxcart__product .ajaxcart__row > div .o-layout__item:nth-child(2) .ajaxcart__product-meta",".cart-form .cart__products .cart__product .cart__row > div .o-layout__item:nth-child(2) .cart__product-meta",".container-widget .shopping-cart-table tbody tr td:nth-child(2) .shopping-cart-table__product-name"],lineItemRemove:["[data-fee-line-item-remove]",'a[href*="quantity=0"]'],lineItemQuantity:["[data-fee-line-item-quantity]",'[name="updates[]"]'],cartSubtotal:["[data-fee-cart-subtotal]",".cart-drawer > .cart-drawer__footer .cart-drawer__subtotal",".cart-footer > .grid > .grid__item:last-child > p:first-child",".cart__footer > .grid > .grid__item:first-child > div:first-child","#cart-form > .cart_bottom > .grid__item.text-right > .cart__subtotal-holder","#MainContent .grid__item.cart__buttons > #CartSubtotal","#shopify-section-cart-template .grid__item.cart__buttons > #CartSubtotal","#CartDrawer .ajaxcart__footer > .ajaxcart__subtotal > .grid.grid--table","#shopify-section-cart-template .cart__footer > .grid > .grid__item > .cart__subtotal-container","#MainContent .cart__footer > .grid > .grid__item:last-child  > p:first-child","#CartDrawer #CartContainer .ajaxcart__footer > .grid--full","#PageContainer .cart > .cart__row--last > .grid--full > .grid__item > .grid--full","#CartDrawer #CartContainer .ajaxcart__footer > .grid--full","#ajaxifyCart > .cart-wrapper > .cart__row:nth-last-child(2)",".main-content .cart-wrapper > .cart__row:nth-last-child(2)","#ajaxifyCart > .cart-form > .cart-row:last-child  .cart-subtotal",".main-content > .cart-form > .cart-row:last-child  .cart-subtotal","#CartSection > .cart > .cart__row:last-child  .cart__subtotal",".PageContent > .Cart > .Cart__Footer > .Cart__Recap > .Cart__Total",".Drawer__Content .Drawer__Footer .Cart__Checkout","#MainContent .grid .cart > .cart__row:last-child  .cart__row--table","#CartDrawer #CartContainer .drawer__footer .grid","#cart_form > div .subtotal .cart_subtotal",".cart_container .cart_content form.js-cart_content__form ul:last-child .js-cart_subtotal",".cart .grid .cart__footer .solid-border .grid",".block-cart .mini-products-list:last-child  .total",".cart_menu form .total_row:first-child ul li",".cart_c > div form .total_row ul li",".shopify-section .reading-container #cartform .subtotal-row",".cart-preview .cart-preview-total",".cart-form .grid .cart-checkout .subtotal","#shopify-section-cart-template form .row .cart-row .total-price","#dropdown-cart .has-items .summary","#cartform .cart-bottom-box .cart-totals--wrapper","#shopify-section-static-cart form .cartitems--container .cartitems .cart-total .cart-subtotal",".atc-banner--container .atc-banner--outer .atc-banner--inner .atc-banner--cart .atc-banner--cart-subtotal","form .row .col-md-4:last-child .card .table-total tbody #subtotal",".ajaxcart__form .ajaxcart__footer > div .ajaxcart__footer-total",".cart-form .cart__footer .cart__footer-total",".cart .ajaxcart__footer .grid--full .grid__item:first-child",".cart .cart__row:last-child .grid .grid__item p:first-child","#CartForm .cart-info-container .info__subtotal","#shopify-section-template-cart form .cart-tools .cart-totals .cart-price",".cart-form .cart-totals .cart-total-row","#cart .mm-panels .mm-panel ul.mm-listview .mm-label","#cart_form .section .offset-by-one .subtotal_amount strong",".modal-cart-form .cart-total-wrapper .row .col-sm-6:first-child .cart-total",".main-cart-form .cart-total-wrapper .row .col-sm-6:first-child .cart-total",".ajaxcart .drawer__footer .grid",".cart .cart__row:last-child  .grid .grid__item .grid",".ajaxcart .ajaxcart__footer .grid--full",".cart .cart__row .grid__item.sm--mt3 p:first-child",".standard-page form .cart-subtotal-row",".ajaxcart .max-width--4 .cart .cart__row:last-child  .grid .grid__item.md--up--text-align--right .table.full--w","form .cart .cart__row:last-child  .grid .grid__item.md--up--text-align--right .table.full--w",".ajaxcart .ajaxcart__footer > .grid--full",".cart.table-wrap .cart__row .grid__item.large--text-right .cart__subtotal",".ajaxcart .ajaxcart__footer .desktop-half:nth-child(2)","#shopping-cart #cartform #basket-right .cart-final-details h3",".container.bottompad > div .twelve .twelve .cart-options .twelve h3 .price-preview",".cart .cart__row .grid__item p:first-child","form .subtotal-row","#cartform .under-cart .subtotal","#cart-form .cart-price p","form .checkout-buttons .s1 p:first-child",".cart-form .cart-tools .cart-totals .cart-price",".static-cart-wrapper .cart .cart-container .cart-container-scrollable .cart-footer .cart-footer-column .cart-totals","#site-header-drawer-cart .cart-mini .cart-container .cart-container-scrollable .cart-footer .cart-footer-column .cart-totals",".template-cart .cart .cart-checkout-field .bottom-cart-total .cart__subtotal span","#your-shopping-cart .page-container .main-content .item .price.subtotal span","#CartDrawer #CartContainer .ajaxcart .ajaxcart__footer .ajaxcart__subtotal .money","#your-shopping-cart #PageContainer .cart .cart__row .cart__subtotal .money",".ajaxcart__content .cart__footer .cart__subtotal span",".template-cart .cartForm .cart__footer .cart__subtotal span",".cart-mini-sidebar .cart-mini-footer .cart-mini-subtotal-value",".template-cart .section-cart .cart .cart-tools .totals .price .money",".mm-panels .mm-opened .mm-counter.price .money span",".cart #content_wrapper .main #cart_form .subtotal_amount .money span",".ajaxcart .ajaxcart__footer .desktop-half:last-child","#cartform #basket-right h4",".cartForm .cart__row .grid .grid__item.text-right .cart__footer__text:first-child",".modal--container .fw--cart form .content .totals .block.spacing--3y",".panel div form .content .totals .block.spacing--3y","#cart-summary .cart-summary-footer .cart-summary-subtotal","#cartform .row.section .half h2","#cartform #basket-right h4",".mini-cart .mini-cart__content .mini-cart__full .mini-cart__footer .mini-cart__total","form .inner .cart__meta .cart__checkout .cart__recap--desktop .cart__total","form .inner .cart__meta--mobile .cart__recap .cart__total","#site-cart .site-nav-container-last .top .cart .cart-out .total",".site-box-content .cart .cart-out .total",".header-cart .header-cart-footer","#mainWrap .cartMain .grid #cartHeading",".cart-form .cart-totals .cart-checkout .cart-total-wrapper .cart-total",".has-popup-tab .popup-tab .total","#cartform .under-cart .column div:first-child",".modal--window .modal--container form .totals .total span",".template--cart .layout--main-content form .total span","#shopify-section-cart-template .cart .checkout .total .price span",".cart #shopify-section-cart-template  #cart_form > .four.columns.omega .money span","#ajaxifyCart .cart-form .ajaxifyCart--row span .money",".cart #shopping-cart #cartform #basket-right .money span",".template-product #cart-summary-overlay .cart-summary-overlay__column-subtotal .cart-summary-overlay__subtotal","#cartform .cf .checkout-col .checkout-buttons .button","#cartform .cart-actions .action-main .cart-tot2 h5","#shopify-section-cart-template .sixteen #cart_form .twelve.columns","form .cart-tools .cart-totals .cart-price-info .cart-price",".ajaxcart .more h3.row",".cart .more h3.row","#cart-form #cart-tools #cart-checkout #cart-subtotal",".topBar__miniCart #mini_cart_form .miniCart__details .miniCart__subtotal ","#cart_form .container .cart__priceBreakdown .section .subtotal .cart_subtotal",".mini-cart .mini-cart__inner .mini-cart__bottom .mini-cart__total",".container form .cart__footer .grid .cart__checkout .cart__recap .cart__total","form .cart-checkout .cart-price",".recently-added table tfoot tr",".custom .row .columns .totals h3",".cart__form .cart__total",".cart-wrapper .cart-inner > div .cart-checkout .cart-info .subtotal",".cart div #shopping-cart-totals-table",".halo-modal-body .cart-popup-content .cart-form .scroll-content .quick-cart .cart-popup-action .total","#dropdown-cart .has-items .summary .total",".cart-form .right-col .total",".cart .cart-subtotal__price","#MainContent .cart__footer .cart__blocks .js-contents"],checkoutButton:['[name="checkout"]']},g=function(t,e,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(t):a?a.value:e.get(t)};class w{constructor(){v.set(this,y)}find(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;for(var r of g(this,v,"f")[t]){var a=e.querySelector(r);if(a)return a}return null}findAll(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;for(var r of g(this,v,"f")[t]){var a=e.querySelectorAll(r);if(a.length>0)return Array.from(a)}return[]}query(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).querySelector(t)}queryAll(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(e.querySelectorAll(t))}}function b(t,e){return t+(0===e?"":" — ".concat(l(100*e)))}function C(t,e){return t+(0===e?"":" — ".concat(e,"%"))}v=new WeakMap;var E=["CHECKBOX","SELECT","RADIO","TEXT","DATE","HIDDEN"],x="mw-fee",T="mw-fee--type-product",j="mw-fee--type-cart",k="mw-fee--type-hidden",O="mw-fee__control-container",P="mw-fee__tooltip-container",A="mw-fee__mobile-descriptrion",L="mw-fee__control",I="mw-fee__control-title",S="mw-fee__control--type-select",D="mw-fee__control--type-checkbox",N="mw-fee__control--type-text",R="mw-tippy",F="data-mw-checkout-button",q="mwFees::core::initialized",M="mwFees::configuration::cart::update",H="mwFees::submit::checkout",U="mwFees::cart::exec::successfully",B="mwFees::bulider::hideOverlay",W="mwFees::core::removeAllPercentFees",Q="mwFees::core::cartExec",G="mwFees::core::updateHtml";function X(t,e,r,a){var i=e.toLowerCase().includes("[product_name]")?r:a,n=e.trim().replace(/\[[product_name\]]+\]/gi,"");return"label"===t?"".concat(n," ").concat(i):{[n]:i}}function $(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function V(t,e){document.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:e}))}var z,J,Y,K,Z,tt,et,rt,at,it=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))},nt=function(t,e,r,a,i){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(t,r):i?i.value=r:e.set(t,r),r},ct=function(t,e,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(t):a?a.value:e.get(t)},ot=function(t,e){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(r[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(t);i<a.length;i++)e.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(t,a[i])&&(r[a[i]]=t[a[i]])}return r};class st{constructor(t,e){z.set(this,null),J.set(this,null),Y.set(this,void 0),K.set(this,void 0),Z.set(this,void 0),tt.set(this,void 0),et.set(this,void 0),rt.set(this,void 0),at.set(this,void 0),nt(this,Z,e,"f"),nt(this,K,t.settings,"f"),nt(this,Y,_(t.cart),"f"),nt(this,tt,t.shop_currency,"f"),nt(this,et,t.cart.items,"f"),nt(this,at,t.multi_currency,"f"),nt(this,rt,t.cart_fees,"f"),this.Dom=new w}updateShopifyCart(t){nt(this,Y,_(t),"f")}updateCartFixedFees(t){nt(this,rt,t,"f")}showOverlay(){if(!ct(this,J,"f")){var t=document.createElement("div");t.classList.add("mws-fees-overlay"),t.innerHTML='<div class="mws-fees-overlay--spinner">&nbsp;</div>',document.body.appendChild(t),nt(this,J,t,"f")}ct(this,J,"f").classList.add("mws-fees-overlay--visible")}hideOverlay(){var t;null===(t=ct(this,J,"f"))||void 0===t||t.classList.remove("mws-fees-overlay--visible")}createCombinedFeeBlock(t,e){var r=document.createElement("div"),a=[];for(var i of e){var n=i.getAttribute("data-fee-hidden-calc-price");a.push(Number(n))}var c=a.reduce(((t,e)=>t+e),0),o=c?l(100*c):"";return r.classList.add("mw-stack","mw-stack--vertical","mw-stack--alignment-trailing","mw-fee--type-combined"),r.innerHTML='\n      <div class="mw-stack">\n        <div class="mw-stack__item">'.concat(t,'</div>\n        <div class="mw-stack__item">\n          <span class="mw-text mw-text--style-strong">').concat(o,"</span>\n        </div>\n      </div>\n    "),r}create(t,e){var{input_type:r}=t,i=ot(t,["input_type"]);if(void 0===e&&(e=""),!E.includes(r))throw new Error("🛑 ".concat(a,' Builder: "').concat(r,'" input type is not recognized.'));var n=this.createControlContainer(i.product_id,i.type,i.title,i.is_required,e);switch(i.options.sort(((t,e)=>t.sort_order-e.sort_order)),r){case"SELECT":return this.createSelectElement(n,i,e);case"CHECKBOX":return this.createCheckboxElement(n,i,e);case"RADIO":return this.createRadioElement(n,i,e);case"TEXT":return this.createTextElement(n,Object.assign(Object.assign({},i),{input_type:r}),e);case"DATE":return this.createDateInputElement(n,Object.assign(Object.assign({},i),{input_type:r}),e);case"HIDDEN":return this.createHiddenElement(i,e);default:throw new Error("🛑 ".concat(a,' Builder: "').concat(r,'" input type is not recognized.'))}}handleChange(e,r,i,n,c,o,s,l){return it(this,void 0,void 0,(function*(){if(ct(this,at,"f")){var d=yield m(ct(this,tt,"f"));nt(this,Y,_(d),"f")}var p=e.target.value;if(p){var v=o.filter((t=>t.variant_id===Number(p)));if(v.length){var y=f({fee_type:n,fee_is_onetime:c,option_price_type:v[0].price_type,option_price:v[0].price,step_percent_value:v[0].step_percent_value,clean_cart:ct(this,Y,"f"),clone_percent_fee:s,shop_currency:ct(this,tt,"f"),target_key:l});if(0!==y){var g=l?ct(this,Y,"f").items.filter((t=>h(t)===l)):[],w={fee_type:n,option_price:v[0].price,shop_currency:ct(this,tt,"f"),total_price:ct(this,Y,"f").total_price,target_price:g.length?g[0].price:void 0},b=Object.assign({[t]:Object.assign(Object.assign(Object.assign({id:r,input_type:n},g.length?{target_key:l}:{}),"PERCENT"===v[0].price_type?{price_type:v[0].price_type}:{}),"PERCENT"===v[0].price_type&&s?{variant_id:p,price:u(w)}:{})},i.length&&g.length?X("property",i,g[0].product_title,g[0].title):{});ct(this,Z,"f").add({id:Number(p),quantity:y,properties:b}),V(Q),ct(this,K,"f").force_not_reload_page&&this.Dom.queryAll("[data-fee-id='".concat(r,"'] select, [data-fee-id='").concat(r,"'] input")).forEach((t=>{t.setAttribute("disabled","disabled")}))}else console.warn("🛠️ ".concat(a,": Calculated qty for product fee product_id ").concat(r," is 0."))}else console.warn("🛠️ ".concat(a,": Not found option for fee: ").concat(r,"."))}}))}createControlContainer(t,e,r,a,i){var n=document.createElement("div");return n.setAttribute("data-fee-id",String(t)),n.setAttribute("data-fee-target-key",i),n.classList.add(x,"PRODUCT"===e?T:j),n.innerHTML='\n      <div class="mw-stack mw-stack--vertical">\n        <div class="mw-stack__item">\n          <label class="mw-label" for="'.concat(t,'">\n            <div class="mw-stack mw-stack--spacing-tight">\n              <div class="mw-stack__item">\n                <span class="mw-text mw-text--style-strong">').concat(r,"</span>\n                ").concat(a?'&nbsp;<span class="mw-text mw-text--style-negative">*</span>':"",'\n              </div>\n              <div class="mw-stack__item ').concat($()?A:P,'"></div>\n            </div>\n          </label>\n        </div>\n        <div class="mw-stack__item ').concat(O,'"></div>\n        <div class="mw-stack__item">\n          <small class="mw-text mw-text--style-negative mw-hidden" data-fee-required-message="">').concat(ct(this,K,"f").translations.fee_required_message,"</small>\n        </div>\n      </div>\n    "),{wrapper:n,setTooltip:function(t){var e;null===(e=n.querySelector(".".concat(P)))||void 0===e||e.appendChild(t)},setDescription:function(t){var e;null===(e=n.querySelector(".".concat(A)))||void 0===e||e.appendChild(t)},setContent:function(){var t;null===(t=n.querySelector(".".concat(O)))||void 0===t||t.append(...arguments)}}}createDescription(t,e){var r=document.createElement("span");r.innerHTML=t,e(r)}createTooltip(t,e){var r=document.createElement("span");r.classList.add("mw-icon"),r.innerHTML='\n      <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M0 10C0 4.478 4.478 0 10 0c5.523 0 10 4.478 10 10 0 5.523-4.477 10-10 10-5.522 0-10-4.477-10-10zm11.125 2.002H8.989v-.141c.01-1.966.492-2.254 1.374-2.782.093-.056.19-.114.293-.178.73-.459 1.292-1.038 1.292-1.883 0-.948-.743-1.564-1.666-1.564-.851 0-1.657.398-1.712 1.533H6.304C6.364 4.693 8.18 3.5 10.294 3.5c2.306 0 3.894 1.447 3.894 3.488 0 1.382-.695 2.288-1.805 2.952l-.238.144c-.79.475-1.009.607-1.02 1.777V12zm.17 3.012a1.344 1.344 0 01-1.327 1.328 1.32 1.32 0 01-1.328-1.328 1.318 1.318 0 011.328-1.316c.712 0 1.322.592 1.328 1.316z" fill="currentColor"/></svg>\n    ',e(r),window.mwFeesTippy(r,{content:t,onCreate(t){t.popper.classList.add(R)}})}createHiddenFeesContainer(){var t=document.createElement("div");t.classList.add("mw-stack","mw-stack--vertical","mw-stack--alignment-trailing",k),nt(this,z,t,"f")}createHiddenElement(e,r){var a,i,n,{title:c,options:o,product_id:s,property_title:d,type:p,is_onetime:_,description:m,clone_percent_fee:v}=e,y=document.createElement("div"),g=o[0],w=ct(this,Y,"f").items.filter((t=>h(t)===r)),b=c===g.title?"".concat(c):"".concat(c," - ").concat(g.title),C=w.length?"".concat(c," ").concat(X("label",d,w[0].product_title,w[0].title)):b,E=!w.length&&ct(this,at,"f")?null===(a=ct(this,rt,"f").filter((t=>t.product_id===s))[0])||void 0===a?void 0:a.price:void 0,x={fee_type:p,fee_is_onetime:_,option_price_type:g.price_type,option_price:g.price,step_percent_value:g.step_percent_value,clean_cart:ct(this,Y,"f"),clone_percent_fee:v,shop_currency:ct(this,tt,"f"),target_key:r},T=f(x),j=T*g.price,k={fee_type:p,option_price:g.price,shop_currency:ct(this,tt,"f"),total_price:ct(this,Y,"f").total_price,target_price:w.length?w[0].price:void 0};if("PERCENT"===g.price_type&&(j=v?T*u(k):T*g.step_percent_value),ct(this,at,"f")){var O="FIXED"===o[0].price_type?ct(this,rt,"f").filter((t=>t.product_id===s)):ct(this,et,"f").filter((e=>{var a,i,n,c;return r?(null===(i=null===(a=e.properties)||void 0===a?void 0:a[t])||void 0===i?void 0:i.target_key)===r:(null===(c=null===(n=e.properties)||void 0===n?void 0:n[t])||void 0===c?void 0:c.id)===s}));O.length&&(j="FIXED"===o[0].price_type?O[0].price*T:O[0].price/100*T)}var P=j?l(100*j):"";y.classList.add("mw-stack__item"),y.innerHTML='\n      <div class="mw-stack" data-fee-id="'.concat(s,'" data-fee-hidden-calc-price="').concat(j,'" data-fee-hidden-target-key="').concat(r,'">\n        <div class="mw-stack__item">').concat(C,'</div>\n        <div class="mw-stack__item">\n          <span class="mw-text mw-text--style-strong">').concat(E?l(100*E):P,"</span>\n        </div>\n      </div>\n    "),ct(this,z,"f")||this.createHiddenFeesContainer();var A="CART"===x.fee_type?'[data-fee-id="'.concat(s,'"]'):'[data-fee-hidden-target-key="'.concat(x.target_key,'"][data-fee-id="').concat(s,'"]');if(this.Dom.query(A,ct(this,z,"f"))||null===(i=ct(this,z,"f"))||void 0===i||i.appendChild(y),m){var L=document.createElement("span");L.classList.add("mw-icon"),L.classList.add("mw-stack__item"),L.innerHTML='\n        <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M0 10C0 4.478 4.478 0 10 0c5.523 0 10 4.478 10 10 0 5.523-4.477 10-10 10-5.522 0-10-4.477-10-10zm11.125 2.002H8.989v-.141c.01-1.966.492-2.254 1.374-2.782.093-.056.19-.114.293-.178.73-.459 1.292-1.038 1.292-1.883 0-.948-.743-1.564-1.666-1.564-.851 0-1.657.398-1.712 1.533H6.304C6.364 4.693 8.18 3.5 10.294 3.5c2.306 0 3.894 1.447 3.894 3.488 0 1.382-.695 2.288-1.805 2.952l-.238.144c-.79.475-1.009.607-1.02 1.777V12zm.17 3.012a1.344 1.344 0 01-1.327 1.328 1.32 1.32 0 01-1.328-1.328 1.318 1.318 0 011.328-1.316c.712 0 1.322.592 1.328 1.316z" fill="currentColor"/></svg>\n      ',window.mwFeesTippy(L,{content:m,onCreate(t){t.popper.classList.add(R)}}),null===(n=y.querySelector(".mw-stack"))||void 0===n||n.prepend(L)}return ct(this,z,"f")}createSelectElement(t,e,r){var{product_id:a,type:i,is_onetime:n,options:c,description:o,property_title:s,clone_percent_fee:l}=e,{translations:{none_option_label:d}}=ct(this,K,"f"),p=document.createElement("select");p.classList.add(L,S),p.name="mw_fees[".concat(a,"]"),p.id=String(a);var _=document.createElement("option");return _.value="",_.textContent=b(d,0),p.appendChild(_),c.forEach((t=>{var e,{title:a,variant_id:c,price:o,price_type:s,step_percent_value:d}=t,_=document.createElement("option"),m=f({fee_type:i,fee_is_onetime:n,option_price_type:s,option_price:o,step_percent_value:d,clean_cart:ct(this,Y,"f"),clone_percent_fee:l,shop_currency:ct(this,tt,"f"),target_key:r}),v=m*o,y=r?ct(this,Y,"f").items.filter((t=>h(t)===r)):[],g=ct(this,at,"f")?(null===(e=ct(this,rt,"f").filter((t=>t.id===c))[0])||void 0===e?void 0:e.price)*m:void 0,w={fee_type:i,option_price:o,shop_currency:ct(this,tt,"f"),total_price:ct(this,Y,"f").total_price,target_price:y.length?y[0].price:void 0};"PERCENT"===s&&(v=l?m*u(w):m*d),_.value=String(c),_.innerHTML=ct(this,at,"f")&&"PERCENT"===s?C(a,o):b(a,g||v),p.appendChild(_)})),p.addEventListener("change",(t=>{this.handleChange(t,a,s,i,n,c,l,r)})),o&&($()?this.createDescription(o,t.setDescription):this.createTooltip(o,t.setTooltip)),t.setContent(p),t.wrapper}createCheckboxElement(e,r,a){var i,{product_id:n,type:c,is_onetime:o,options:s,description:l,property_title:d,clone_percent_fee:p}=r,_=document.createElement("input"),m=document.createElement("label"),v=document.createElement("div"),y=s[0],g=f({fee_type:c,fee_is_onetime:o,option_price_type:y.price_type,option_price:y.price,step_percent_value:y.step_percent_value,clean_cart:ct(this,Y,"f"),clone_percent_fee:p,shop_currency:ct(this,tt,"f"),target_key:a}),w=g*y.price,E=a?ct(this,Y,"f").items.filter((t=>h(t)===a)):[],x=!E.length&&ct(this,at,"f")?null===(i=ct(this,rt,"f").filter((t=>t.product_id===n))[0])||void 0===i?void 0:i.price:void 0,T={fee_type:c,option_price:y.price,shop_currency:ct(this,tt,"f"),total_price:ct(this,Y,"f").total_price,target_price:E.length?E[0].price:void 0};if("PERCENT"===y.price_type&&(w=p?g*u(T):g*y.step_percent_value),ct(this,at,"f")){var j="FIXED"===s[0].price_type?ct(this,rt,"f").filter((t=>t.product_id===n)):ct(this,et,"f").filter((e=>{var r,i,c,o;return a?(null===(i=null===(r=e.properties)||void 0===r?void 0:r[t])||void 0===i?void 0:i.target_key)===a:(null===(o=null===(c=e.properties)||void 0===c?void 0:c[t])||void 0===o?void 0:o.id)===n}));j.length&&(w="FIXED"===s[0].price_type?j[0].price*g:j[0].price/100*g)}return _.classList.add(L,D),_.type="checkbox",_.name="mw_fees[".concat(n,"]"),_.value=String(y.variant_id),_.id=String(n),_.addEventListener("change",(t=>{this.handleChange(t,n,d,c,o,s,p,a)})),v.classList.add(I),v.innerHTML='\n      <span class="mw-text"> '.concat(ct(this,at,"f")&&"PERCENT"===y.price_type?C(y.title,y.price):b(y.title,x?Number(x):w),"\n      </span>\n    "),m.classList.add("mw-label"),m.append(_,v),l&&($()?this.createDescription(l,e.setDescription):this.createTooltip(l,e.setTooltip)),e.setContent(m),e.wrapper}createRadioElement(e,r,a){var{product_id:i,type:n,is_onetime:c,options:o,description:s,property_title:l,clone_percent_fee:d}=r,p=document.createElement("div"),_=[];return p.classList.add("mw-stack","mw-stack--vertical","mw-stack--spacing-tight"),o.forEach((e=>{var r,{title:s,variant_id:p,price:m,price_type:v,step_percent_value:y}=e,g=document.createElement("div"),w=document.createElement("input"),E=document.createElement("label"),x=document.createElement("div"),T=f({fee_type:n,fee_is_onetime:c,option_price_type:v,option_price:m,step_percent_value:y,clean_cart:ct(this,Y,"f"),clone_percent_fee:d,shop_currency:ct(this,tt,"f"),target_key:a}),j=T*m,k=a?ct(this,Y,"f").items.filter((t=>h(t)===a)):[],O=ct(this,at,"f")?(null===(r=ct(this,rt,"f").filter((t=>t.id===p))[0])||void 0===r?void 0:r.price)*T:void 0,P={fee_type:n,option_price:m,shop_currency:ct(this,tt,"f"),total_price:ct(this,Y,"f").total_price,target_price:k.length?k[0].price:void 0};if("PERCENT"===v&&(j=d?T*u(P):T*y),ct(this,at,"f")){var A="FIXED"===o[0].price_type?ct(this,rt,"f").filter((t=>t.product_id===i)):ct(this,et,"f").filter((e=>{var r,n,c,o;return a?(null===(n=null===(r=e.properties)||void 0===r?void 0:r[t])||void 0===n?void 0:n.target_key)===a:(null===(o=null===(c=e.properties)||void 0===c?void 0:c[t])||void 0===o?void 0:o.id)===i}));A.length&&(j="FIXED"===o[0].price_type?A[0].price*T:A[0].price/100*T)}g.classList.add("mw-stack__item"),w.classList.add(L,D),w.type="radio",w.name="mw_fees[".concat(i,"]"),w.value=String(p),w.id=String(p),w.addEventListener("change",(t=>{this.handleChange(t,i,l,n,c,o,d,a)})),x.classList.add(I),x.innerHTML='\n      <span class="mw-text">'.concat(ct(this,at,"f")&&"PERCENT"===v?C(s,m):b(s,O||j),"</span>\n    "),E.classList.add("mw-label"),E.append(w,x),g.appendChild(E),_.push(g)})),p.append(..._),e.setContent(p),s&&($()?this.createDescription(s,e.setDescription):this.createTooltip(s,e.setTooltip)),e.wrapper}createTextElement(e,r,a){var i,{product_id:n,description:c,options:o,input_type:s,property_title:l,is_onetime:d,type:p,clone_percent_fee:v}=r,y=document.createElement("div"),g=document.createElement("div"),w=document.createElement("div"),E=document.createElement("input"),x=document.createElement("button"),T=document.createElement("span"),{title:j,price:k,variant_id:O,price_type:P,step_percent_value:A}=o[0],{translations:{value_blank_message:I,apply_button_label:S,date_fee_property_name:D,text_fee_property_name:R}}=ct(this,K,"f"),F=f({fee_type:p,fee_is_onetime:d,option_price_type:P,option_price:k,step_percent_value:A,clean_cart:ct(this,Y,"f"),clone_percent_fee:v,shop_currency:ct(this,tt,"f"),target_key:a}),q=F*k,M=a?ct(this,Y,"f").items.filter((t=>h(t)===a)):[],H=ct(this,at,"f")?(null===(i=ct(this,rt,"f").filter((t=>t.product_id===n))[0])||void 0===i?void 0:i.price)*F:void 0,U={fee_type:p,option_price:k,shop_currency:ct(this,tt,"f"),total_price:ct(this,Y,"f").total_price,target_price:M.length?M[0].price:void 0};return"PERCENT"===P&&(q=v?F*u(U):F*A),y.classList.add("mw-stack","mw-stack--vertical","mw-stack--spacing-tight"),y.innerHTML='\n      <div class="mw-stack__item">\n        <label class="mw-label" for='.concat(String(n),'>\n          <span class="mw-text">').concat(ct(this,at,"f")&&"PERCENT"===P?C(j,k):b(j,H||q),"</span>\n        </label>\n      </div>\n    "),T.classList.add("mw-text","mw-text--style-negative","mw-hidden"),T.innerText=I,w.classList.add("mw-stack","mw-stack--alignment-center","mw-stack--spacing-tight"),w.innerHTML='\n      <div class="mw-stack__item">\n        <div class="mw-stack mw-stack--vertical mw-stack--nowrap mw-stack--spacing-tight">\n          <div class="mw-stack__item" data-input-container></div>\n          <div class="mw-stack__item" data-helptext-container></div>\n          <div class="mw-stack__item" data-button-container></div>\n        </div>\n      </div>\n    ',x.classList.add("btn","button"),x.innerText=S,x.addEventListener("click",(e=>it(this,void 0,void 0,(function*(){if(e.preventDefault(),ct(this,at,"f")){var r=yield m(ct(this,tt,"f"));nt(this,Y,_(r),"f")}var i=E.value;if(T.classList.add("mw-hidden"),i){var c="DATE"===s?D:R;x.disabled=!0;var o=a?ct(this,Y,"f").items.filter((t=>h(t)===a)):[],d=l.length&&o.length?X("property",l,o[0].product_title,o[0].title):{},f={fee_type:p,option_price:k,shop_currency:ct(this,tt,"f"),total_price:ct(this,Y,"f").total_price,target_price:o.length?o[0].price:void 0};ct(this,Z,"f").add({id:O,quantity:F,properties:Object.assign({[c]:i,[t]:Object.assign(Object.assign(Object.assign({id:n,input_type:p},o.length?{target_key:a}:{}),"PERCENT"===P?{price_type:P}:{}),"PERCENT"===P&&v?{variant_id:O,price:u(f)}:{})},d)}),V(Q),x.disabled=!1}else T.classList.remove("mw-hidden")})))),E.classList.add(L,N),E.type="text",E.name="mw_fees[".concat(n,"]"),E.id=String(n),w.querySelector("[data-input-container]").appendChild(E),w.querySelector("[data-button-container]").appendChild(x),w.querySelector("[data-helptext-container]").appendChild(T),g.classList.add("mw-stack__item"),g.appendChild(w),y.append(g),e.setContent(y),c&&($()?this.createDescription(c,e.setDescription):this.createTooltip(c,e.setTooltip)),e.wrapper}createDateInputElement(t,e,r){var i=this.createTextElement(t,e,r),n=i.querySelector("input"),{calendar_format:c}=ct(this,K,"f");if(!n)throw new Error("🛑 ".concat(a," Builder: date input element not found."));return(0,window.mwFeesFlatpickr)(n,{dateFormat:c,minDate:"today",onReady(t,e,r){var a,i=document.createElement("div"),n=r.calendarContainer;i.classList.add("mw-flatpickr"),null===(a=n.parentNode)||void 0===a||a.appendChild(i),i.appendChild(n)}}),i}}z=new WeakMap,J=new WeakMap,Y=new WeakMap,K=new WeakMap,Z=new WeakMap,tt=new WeakMap,et=new WeakMap,rt=new WeakMap,at=new WeakMap;var lt=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))};function dt(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return lt(this,void 0,void 0,(function*(){if(!t.length)return t;var r=[],i=[];return t.forEach((t=>t.options.filter((t=>!t.variant_id)).length?(r.push(t.product_id),void console.warn("🛠️ ".concat(a,': One or more options "').concat(t.title,'" does not have a variant_id.'))):t.options.filter((t=>!(t.step_percent_value>0))).length?(r.push(t.product_id),void console.warn("🛠️ ".concat(a,': One or more options "').concat(t.title,'" have step_percent_value <= 0.'))):void(e&&t.options.forEach((e=>lt(this,void 0,void 0,(function*(){i.push({product_id:t.product_id,variant_id:e.variant_id,title:t.title,request:fetch("".concat(n,"variants/").concat(e.variant_id,".json"),{method:"HEAD"})})}))))))),(yield Promise.all(i.map((t=>t.request)))).map(((t,e)=>{t.status>300&&i[e]&&(r.push(i[e].product_id),console.warn("🛠️ ".concat(a,': Fee "').concat(i[e].title,'" is not available to add to the cart, status ').concat(t.status,".")))})),t.filter((t=>!r.includes(t.product_id)))}))}function pt(t,e,r,i){return lt(this,void 0,void 0,(function*(){if(![e,r,i].every((t=>t)))return console.warn("🛠️ ".concat(a,": getPercentVariantIdByPrice not found required arguments: ").concat([e,r,i],".")),[];try{var n=yield fetch("".concat(c,"percent/fee/").concat(t,"/").concat(e,"/").concat(r,"/").concat(Math.round(i)),{method:"POST"});return n.ok?n.json():[]}catch(t){return console.warn("🛠️ ".concat(a,": getPercentVariantIdByPrice is failed ").concat(t,".")),[]}}))}function _t(t){return t.filter((t=>t.clone_percent_fee&&t.options.filter((t=>"PERCENT"===t.price_type)).length))}var ut,ft,mt,ht,vt,yt,gt,wt,bt=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))},Ct=function(t,e,r,a,i){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(t,r):i?i.value=r:e.set(t,r),r},Et=function(t,e,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(t):a?a.value:e.get(t)},xt=function(t,e){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(r[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(t);i<a.length;i++)e.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(t,a[i])&&(r[a[i]]=t[a[i]])}return r},Tt="app=mwsfees";class jt{constructor(t){ut.set(this,[]),ft.set(this,new Set),mt.set(this,new Set),ht.set(this,void 0),vt.set(this,void 0),yt.set(this,void 0),gt.set(this,void 0),wt.set(this,void 0),Ct(this,ht,t.template_name,"f"),Ct(this,vt,t.shop.permanent_domain,"f"),Ct(this,gt,t.settings,"f"),Ct(this,yt,!1,"f"),Ct(this,wt,!!_t(t.fees).length,"f"),this.addToCart=this.addToCart.bind(this),this.updateCart=this.updateCart.bind(this)}listen(t,e){var r=window.fetch,a=window.XMLHttpRequest.prototype.open,i=["/cart/change","/cart/update","/cart/add"];window.fetch=function(){for(var a=arguments.length,n=new Array(a),c=0;c<a;c++)n[c]=arguments[c];return bt(this,void 0,void 0,(function*(){var[a]=n,c=yield r.apply(this,n);if("string"==typeof a&&(a.includes(Tt)||!i.some((t=>a.includes(t)))))return c;var o=yield c.clone().json();return c.ok&&setTimeout((()=>bt(this,void 0,void 0,(function*(){yield t(o)}))),e),c}))},window.XMLHttpRequest.prototype.open=function(){for(var r=arguments.length,n=new Array(r),c=0;c<r;c++)n[c]=arguments[c];var[,o]=n;return this.addEventListener("loadend",(function(){!o.includes(Tt)&&i.some((t=>o.includes(t)))&&setTimeout((()=>{try{t(JSON.parse(this.response))}catch(t){}}),e)})),a.apply(this,n)}}get(){return bt(this,void 0,void 0,(function*(){try{var t=yield fetch("".concat(n,"cart.json?").concat(Tt)),e=yield t.json();if(!t.ok)throw new Error(t.statusText);return{error:!1,content:e}}catch(t){return{error:!0,content:"⛔️ ".concat(a,": Cart network error.")}}}))}clear(){return bt(this,void 0,void 0,(function*(){try{var t=yield fetch("".concat(n,"cart/clear?").concat(Tt));if(!t.ok)throw new Error(t.statusText);return{error:!1,content:"OK"}}catch(t){return{error:!0,content:"⛔️ ".concat(a,": Cart network error.")}}}))}add(t){if(t.properties)for(var e in t.properties)e.startsWith("_")||(t.properties[e]=(r=t.properties[e],a=void 0,(a=document.createElement("textarea")).innerHTML=r,a.value));var r,a;Et(this,ut,"f").push(t)}remove(t){t.quantity=0,Et(this,ft,"f").add(t)}update(t){Et(this,mt,"f").add(t)}isErrorLastRequest(){return Et(this,yt,"f")}isAffected(){return Boolean([...Et(this,ft,"f"),...Et(this,mt,"f"),...Et(this,ut,"f")].length)}exec(){return bt(this,void 0,void 0,(function*(){return Ct(this,yt,!1,"f"),yield this.handlePercentFee(),Promise.all([this.updateCart(),this.addToCart()])}))}updateCart(){return bt(this,void 0,void 0,(function*(){if(0===[...Et(this,ft,"f"),...Et(this,mt,"f")].length)return Promise.resolve({error:!1,content:null});try{var t=[...Et(this,ft,"f"),...Et(this,mt,"f")].reduce(((t,e)=>{var{id:r,quantity:a}=e;return t[r]=a,t}),{});Et(this,ft,"f").clear(),Et(this,mt,"f").clear();var e=yield fetch("".concat(n,"cart/update.js?").concat(Tt),{method:"POST",body:JSON.stringify({updates:t}),headers:{"Content-Type":"application/json"}}),r=yield e.json();return e.ok?{error:!1,content:r}:(Ct(this,yt,!0,"f"),{error:!0,content:r.description})}catch(t){return{error:!0,content:"⛔️ ".concat(a,": Cart network error.")}}}))}addToCart(){return bt(this,void 0,void 0,(function*(){if(0===Et(this,ut,"f").length)return Promise.resolve({error:!1,content:null});try{var t=Et(this,ut,"f").map((t=>{var{properties:e}=t,r=xt(t,["properties"]);return Object.assign(Object.assign({},r),{properties:e})}));Et(this,ut,"f").length=0;var e=yield fetch("".concat(n,"cart/add.js?").concat(Tt),{method:"POST",body:JSON.stringify({items:t}),headers:{"Content-Type":"application/json"}}),r=yield e.json();return e.ok?(Et(this,wt,"f")&&(yield this.detectZeroVariantOnCart()),{error:!1,content:r}):(Ct(this,yt,!0,"f"),{error:!0,content:r.description})}catch(t){return{error:!0,content:"⛔️ ".concat(a,": Cart network error.")}}}))}detectZeroVariantOnCart(e){return bt(this,void 0,void 0,(function*(){e&&(yield new Promise((t=>setTimeout(t,400))));var r="cart"===Et(this,ht,"f"),a=yield this.get(),i="mws_fees_zero_variant_on_cart",n=(a.error?{}:a.content).items.filter((e=>!e.product_id&&e.properties&&e.properties[t])).length,c=localStorage.getItem(i),o=null===c?0:parseInt(c,10);return 0===n?(localStorage.removeItem(i),void(!Et(this,gt,"f").force_not_reload_page&&o>0&&r?window.location.reload():V(B))):o>=50?(localStorage.removeItem(i),void(!Et(this,gt,"f").force_not_reload_page&&r?window.location.reload():V(B))):(localStorage.setItem(i,(o+1).toString()),void(n>0?yield this.detectZeroVariantOnCart(!0):localStorage.removeItem(i)))}))}handlePercentFee(){return bt(this,void 0,void 0,(function*(){var e=this,r=new Set;for(var i of Et(this,ut,"f")){var n=i.properties&&i.properties[t]?i.properties[t]:{};"PERCENT"===(null==n?void 0:n.price_type)&&(null==n?void 0:n.variant_id)&&r.add(pt(Et(this,vt,"f"),null==n?void 0:n.id,null==n?void 0:n.variant_id,100*(null==n?void 0:n.price)))}if(r.size){var c=yield Promise.all(r);if(c.filter((t=>t.status>300)).length)return void V(W);var o=[],s=[],l=function*(){var e=d.properties&&d.properties[t]?d.properties[t]:{};if("PERCENT"===(null==e?void 0:e.price_type)&&(null==e?void 0:e.variant_id)){var r=c.filter((t=>!!(null==t?void 0:t.product_id)&&((null==t?void 0:t.product_id)===parseInt(e.id,10)&&(null==t?void 0:t.variant_id)===parseInt(e.variant_id,10)&&(null==t?void 0:t.price)/100===parseFloat(e.price))));r.length&&r[0].percent_variant_id?(s.push(d),delete e.price,d.properties&&d.properties[t]&&(d.properties[t]=e),d.id=r[0].percent_variant_id,o.push(d)):(s.push(d),console.warn("🛠️ ".concat(a,": Not found percent variant_id from response for variant_id: ").concat(null==e?void 0:e.variant_id," and price: ").concat(null==e?void 0:e.price,".")))}};for(var d of Et(this,ut,"f"))yield*l();var p=function*(t){Ct(e,ut,Et(e,ut,"f").filter((e=>t!==e)),"f")};for(var _ of s)yield*p(_);Ct(this,ut,[...Et(this,ut,"f"),...o],"f")}}))}}ut=new WeakMap,ft=new WeakMap,mt=new WeakMap,ht=new WeakMap,vt=new WeakMap,yt=new WeakMap,gt=new WeakMap,wt=new WeakMap;var kt=i(70),Ot=i.n(kt),Pt=i(562),At=i.n(Pt);function Lt(t,e,r,a,i){var n=[],c=function(){switch(o.type){case"PRODUCT_TITLE":case"PRODUCT_SKU":var{operator:e,value:c}=o,s=Dt[o.type];switch(e){case"EQUALS":case"CONTAINS":n.push([r[s]].some((t=>It(e,c,t))));break;case"NOT_EQUALS":case"NOT_CONTAINS":n.push([r[s]].every((t=>It(e,c,t))))}break;case"PRODUCT_PRICE":case"PRODUCT_WEIGHT":case"TOTAL_CART_QUANTITY":case"TOTAL_CART_PRICE":case"CART_LINE_ITEM_QUANTITY":case"CART_LINE_ITEM_PRICE":case"TOTAL_CART_WEIGHT":var l=Dt[o.type],d=["TOTAL_CART_WEIGHT","PRODUCT_WEIGHT"].includes(o.type)?o.value.value:o.value;n.push(function(t,e,r){if(null===r)return"NOT_EQUALS"===t;switch(t){case"EQUALS":return e===r;case"NOT_EQUALS":return e!==r;case"GREATER_THAN":return r>e;case"EQUALS_GREATER_THAN":return r>=e;case"LESS_THAN":return r<e;case"EQUALS_LESS_THAN":return r<=e;default:return!1}}(o.operator,d,r[l]));break;case"PRODUCT_ID":case"PRODUCT_VARIANT_ID":case"PRODUCT_TYPE":case"PRODUCT_TAG":case"PRODUCT_VENDOR":case"PRODUCT_COLLECTION":case"CUSTOMER_TAG":var p=Dt[o.type];if("ALL"===t&&"CART"===i){var _=r[p];void 0!==a[p]&&(_=a[p]),n.push(function(t,e,r){if(!e.length)return!1;switch(e.forEach(((t,r)=>{e[r]=e[r].toLowerCase()})),r.forEach(((t,e)=>{r[e]=r[e].toLowerCase()})),t){case"IS_ONE_OF":return At()(e,r).length>0;case"IS_NOT_ONE_OF":return 0===At()(e,r).length;case"IS_OF":return e.toString()===r.toString();case"IS_NOT_OF":return Ot()(e,r).length>0;default:return!1}}(o.operator,o.value,_))}else n.push(function(t,e,r){if(!e.length)return!1;switch(e.forEach(((t,r)=>{e[r]=e[r].toLowerCase()})),r.forEach(((t,e)=>{r[e]=r[e].toLowerCase()})),t){case"IS_ONE_OF":return At()(e,r).length>0;case"IS_NOT_ONE_OF":return 0===At()(e,r).length;default:return!1}}(o.operator,o.value,r[p]))}};for(var o of e)c();return"ALL"===t?n.every((t=>!0===t)):n.some((t=>!0===t))}function It(t,e,r){if(null===r)return"NOT_EQUALS"===t;switch(e=e.toLowerCase().trim(),r=r.toLowerCase(),t){case"EQUALS":return e===r;case"NOT_EQUALS":return e!==r;case"CONTAINS":return r.includes(e);case"NOT_CONTAINS":return!r.includes(e);default:return!1}}function St(t,e){return[...new Set([...t,...e])].filter((t=>void 0!==t))}var Dt={TOTAL_CART_QUANTITY:"total_cart_qty",TOTAL_CART_PRICE:"total_cart_price",TOTAL_CART_WEIGHT:"total_cart_weight",CART_LINE_ITEM_QUANTITY:"cart_line_item_qty",CART_LINE_ITEM_PRICE:"cart_line_item_price",PRODUCT_WEIGHT:"product_weight",PRODUCT_PRICE:"product_price",PRODUCT_ID:"product_id",PRODUCT_VARIANT_ID:"product_variant_id",PRODUCT_TYPE:"product_type",PRODUCT_TAG:"product_tag",PRODUCT_VENDOR:"product_vendor",PRODUCT_COLLECTION:"product_collection",CUSTOMER_TAG:"customer_tag",PRODUCT_TITLE:"product_title",PRODUCT_SKU:"product_sku"};var Nt=new class{constructor(){this.storage=localStorage,this.expiration_prefix="__expired_storage__"}getTimestamp(){return Math.floor((new Date).getTime()/1e3)}removeItem(t){this.storage.removeItem(t),this.storage.removeItem(this.expiration_prefix+t)}setItem(t,e,r){this.storage.setItem(t,e),r&&this.updateExpiration(t,r)}getTimeLeft(t){var e=Number(this.storage.getItem(this.expiration_prefix+t));return e&&!isNaN(e)?e-this.getTimestamp():null}isExpired(t){var e=this.getTimeLeft(t);return null!==e&&e<=0}getItem(t){return this.isExpired(t)?(this.removeItem(t),null):this.storage.getItem(t)}updateExpiration(t,e){this.storage.getItem(t)&&this.storage.setItem(this.expiration_prefix+t,String(e+this.getTimestamp()))}},Rt=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))},Ft="mw_fees__visitor_geo";var qt=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))};var Mt,Ht=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))},Ut=function(t,e,r,a,i){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(t,r):i?i.value=r:e.set(t,r),r},Bt=function(t,e,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(t):a?a.value:e.get(t)};Mt=new WeakMap;var Wt=class{constructor(t){this.cartValidated=!1,this.cartExecInProgress=!1,Mt.set(this,void 0);var e=Object.assign(Object.assign({},t),{clean_cart:_(t.cart),fees:t.fees,multi_currency:Boolean(t.shop_currency&&window.Shopify.currency.active!==t.shop_currency)});Ut(this,Mt,window.mwFeesCustomUpdateConfig?window.mwFeesCustomUpdateConfig(e):e,"f"),this.Cart=new jt(this.config),this.Builder=new st(this.config,this.Cart),this.Dom=new w,this.isFeeApplicable=this.isFeeApplicable.bind(this),this.updateCartData=this.updateCartData.bind(this),this.updateHtml=this.updateHtml.bind(this),this.applyHiddenFees=this.applyHiddenFees.bind(this),this.cartExec=this.cartExec.bind(this),this.validateCart=this.validateCart.bind(this),this.onCheckout=this.onCheckout.bind(this),this.attachEvents=this.attachEvents.bind(this)}get config(){return Bt(this,Mt,"f")}init(){return Ht(this,void 0,void 0,(function*(){window.mwFeesCustom&&window.mwFeesCustom();var t=yield function(t,e){return qt(this,void 0,void 0,(function*(){var r=[];if(!e)return r;var i=[],c=t.filter((t=>t.options.some((t=>"FIXED"===t.price_type))));if(!c.length)return r;c.forEach((t=>{var e=fetch("".concat(n,"products/").concat(t.product_handle,".json"));i.push(e)}));var o=yield Promise.all(i);for(var s of o)try{(yield s.json()).product.variants.map((t=>{var e={price:Number(t.price),product_id:t.product_id,id:t.id};r.push(e)}))}catch(t){console.warn("🛠️ ".concat(a,": catch exception on fixedFeesByHandle, item.status: ").concat(s.status,"."))}return r}))}(this.config.fees,this.config.multi_currency);this.Builder.updateCartFixedFees(t),this.config.multi_currency&&(yield this.multiCurrencyCart(this.config.shop_currency)),this.config.geo_visitor=yield function(t){return Rt(this,void 0,void 0,(function*(){var e=Nt.getItem(Ft);if(e){var r={country:"",region_code:""};try{r=JSON.parse(e)}catch(t){throw new Error("⛔️ ".concat(a,": Cannot parse geo visitor object from storage."))}return r}try{var i=yield fetch("https://fees-next-front.mageworx.com/mws-geo/".concat(t)),n=yield i.json();return Nt.setItem(Ft,JSON.stringify(n),3600),n}catch(t){throw new Error("⛔️ ".concat(a,": Cannot get customer country/region code."))}}))}(this.config.shop.permanent_domain),this.attachEvents(),window.mwFees=this,V(q)}))}multiCurrencyCart(t){return Ht(this,void 0,void 0,(function*(){if(_t(this.config.fees).length){var e=yield m(t);this.config.cart=e;var{total_price:r,items:a}=_(e);this.config.clean_cart.total_price=r,this.config.clean_cart.items=a,this.Builder.updateShopifyCart(e)}}))}updateCartData(){return Ht(this,void 0,void 0,(function*(){var t=new DOMParser,e=yield fetch("".concat(n,"cart")),r=yield e.text(),i=t.parseFromString(r,"text/html").getElementById("mwFeesCart");if(!i)throw new Error("🛑 ".concat(a,": cart object tag is missing."));if(!i.textContent)throw new Error("🛑 ".concat(a,": cart object is missing."));this.config.cart=JSON.parse(i.textContent),this.config.clean_cart=_(this.config.cart),this.Builder.updateShopifyCart(this.config.cart),V(M,this.config.cart)}))}cartExec(){return Ht(this,void 0,void 0,(function*(){var t=this.Cart.isAffected();if(!this.cartExecInProgress&&t){this.cartExecInProgress=!0,t&&this.Builder.showOverlay();try{yield this.Cart.exec(),this.Cart.isErrorLastRequest()&&(this.config.fees=yield dt(this.config.fees,!0)),this.cartExecInProgress=!1,!t||this.Cart.isErrorLastRequest()||"cart"!==this.config.template_name&&!this.config.settings.force_reload_page||!this.config.settings.force_not_reload_page&&window.location.reload(),t&&V(U)}finally{this.Cart.isErrorLastRequest()&&(this.config.fees=yield dt(this.config.fees,!0)),yield this.updateCartData(),this.cartExecInProgress=!1,this.Builder.hideOverlay()}}}))}applyHiddenFees(){return Ht(this,void 0,void 0,(function*(){var{cart:e,clean_cart:r,fees:i}=this.config;i.filter((t=>"HIDDEN"===t.input_type)).forEach((i=>{var n,c=this.isFeeApplicable(i);if(c.result){var o=i.options[0];if("CART"!==i.type)null===(n=c.items)||void 0===n||n.filter((t=>t.result)).forEach((n=>{var c=e.items.filter((e=>{var r,a,i,c;return(e.variant_id===o.variant_id||(null===(a=null===(r=e.properties)||void 0===r?void 0:r[t])||void 0===a?void 0:a.variant_id)===o.variant_id)&&(null===(c=null===(i=e.properties)||void 0===i?void 0:i[t])||void 0===c?void 0:c.target_key)===n.target_key})),s=r.items.filter((t=>h(t)===n.target_key));if(!c.length&&s.length){var l=f({fee_type:i.type,fee_is_onetime:i.is_onetime,option_price_type:o.price_type,option_price:o.price,step_percent_value:o.step_percent_value,clean_cart:r,clone_percent_fee:i.clone_percent_fee,shop_currency:this.config.shop_currency,target_key:n.target_key});if(0===l)return void console.warn("🛠️ ".concat(a,": Calculated qty for product fee ").concat(i.title," is 0."));var d=i.property_title.length?X("property",i.property_title,s[0].product_title,s[0].title):{},p={fee_type:i.type,option_price:o.price,shop_currency:this.config.shop_currency,total_price:r.total_price,target_price:s[0].price};this.Cart.add({id:o.variant_id,quantity:l,properties:Object.assign({[t]:Object.assign(Object.assign({id:i.product_id,target_key:n.target_key,input_type:i.input_type},"PERCENT"===o.price_type?{price_type:o.price_type}:{}),"PERCENT"===o.price_type&&i.clone_percent_fee?{variant_id:o.variant_id,price:u(p)}:{})},d)})}}));else{var s=e.items.filter((e=>{var r,a;return e.variant_id===o.variant_id||(null===(a=null===(r=e.properties)||void 0===r?void 0:r[t])||void 0===a?void 0:a.variant_id)===o.variant_id}));if(!s.length){var l=f({fee_type:i.type,fee_is_onetime:i.is_onetime,option_price_type:o.price_type,option_price:o.price,step_percent_value:o.step_percent_value,clean_cart:r,clone_percent_fee:i.clone_percent_fee,shop_currency:this.config.shop_currency});if(0===l)return void console.warn("🛠️ ".concat(a,": Calculated qty for cart fee ").concat(i.title," is 0."));var d={fee_type:i.type,option_price:o.price,shop_currency:this.config.shop_currency,total_price:r.total_price};this.Cart.add({id:o.variant_id,quantity:l,properties:{[t]:Object.assign(Object.assign({id:i.product_id,input_type:i.input_type},"PERCENT"===o.price_type?{price_type:o.price_type}:{}),"PERCENT"===o.price_type&&i.clone_percent_fee?{variant_id:o.variant_id,price:u(d)}:{})}})}}}})),yield this.cartExec()}))}validateCart(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1?arguments[1]:void 0;return Ht(this,void 0,void 0,(function*(){var i=[M,H];this.config.multi_currency&&i.includes(r)&&(yield this.multiCurrencyCart(this.config.shop_currency));var{fees:n,cart:c}=this.config,o=n.map((t=>t.product_id)),s=n.filter((t=>t.is_onetime||"CART"===t.type)).map((t=>t.product_id)),l=new Set;if(c.items.forEach((e=>{var r,{properties:i,key:c,quantity:d,variant_id:p,price:_,product_id:m,product_type:v}=e,y=null==i?void 0:i[t];if(!o.includes(m)&&!["mws_fee_generated_clone"].includes(v)||y){if(y){var g=parseInt(null==y?void 0:y.id,10),w=parseInt(null==y?void 0:y.variant_id,10),b=null==y?void 0:y.target_key;if(g&&l.add(g),void 0!==this.config.deactivated_clones&&this.config.deactivated_clones.includes(m))return this.Cart.remove({id:c}),void console.warn("🛠️ ".concat(a,": Found deactivated clone with product_id: ").concat(m,"."));if(!o.includes(g))return this.Cart.remove({id:c}),void console.warn("🛠️ ".concat(a,": Applied fee ").concat(g," not found in our actual list of fee."));var C=n.filter((t=>t.product_id===g))[0],E=C.options.filter((t=>t.variant_id===p||t.variant_id===w))[0];if(!E)return this.Cart.remove({id:c}),void console.warn("🛠️ ".concat(a,': Applied fee "').concat(C.title,'" with associated option.variant_id not found.'));var x=this.isFeeApplicable(C),T=null===(r=x.items)||void 0===r?void 0:r.find((t=>t.target_key===b&&!1===t.result));if(!x.result||T)return this.Cart.remove({id:c}),void console.warn("🛠️ ".concat(a,': Applied fee "').concat(C.title,'" conditions check failed.'));if(s.includes(g)&&"FIXED"===E.price_type&&d>1)return this.Cart.update({id:c,quantity:1}),void console.warn("🛠️ ".concat(a,': Applied fee "').concat(C.title,'" is onetime but quantity more than 1.'));var j=f({fee_type:C.type,fee_is_onetime:C.is_onetime,option_price_type:E.price_type,option_price:E.price,step_percent_value:E.step_percent_value,clean_cart:this.config.clean_cart,clone_percent_fee:C.clone_percent_fee,shop_currency:this.config.shop_currency,target_key:y.target_key});if(j!==d&&(this.Cart.update({id:c,quantity:j}),console.warn("🛠️ ".concat(a,': Applied fee "').concat(C.title,'" have quantity not agreed.'))),"PERCENT"===E.price_type&&C.clone_percent_fee){var k=this.config.clean_cart.items.filter((t=>h(t)===y.target_key)),O=u({fee_type:C.type,option_price:E.price,shop_currency:this.config.shop_currency,total_price:this.config.clean_cart.total_price,target_price:k.length?k[0].price:void 0});O!==_/100&&(this.Cart.remove({id:c}),console.warn("🛠️ ".concat(a,': Applied fee "').concat(C.title,'" has the wrong price; calc: ').concat(O," cur: ").concat(_/100,".")))}}}else this.Cart.remove({id:c})})),yield this.cartExec(),e){var d=this.config.fees.filter((t=>this.isFeeApplicable(t).result&&t.is_required&&!l.has(t.product_id)));if(d.forEach((t=>{this.Dom.queryAll('[data-fee-id="'.concat(t.product_id,'"] [data-fee-required-message]')).forEach((t=>t.classList.remove("mw-hidden")))})),d.length)return console.warn("🛠️ ".concat(a,": Not applied required fees.")),!1}return this.config.multi_currency&&i.includes(r)&&(yield this.multiCurrencyCart(window.Shopify.currency.active)),!0}))}onCheckout(t){var e;return Ht(this,void 0,void 0,(function*(){var r=()=>{this.cartValidated=!0,t.target.click()};if(!this.cartValidated){t.preventDefault(),t.stopPropagation(),"cart"!==this.config.template_name&&this.updateHtml();try{var i=yield this.validateCart(!0,H);if(i)return void r();if(!i&&"cart"!==this.config.template_name&&!this.Dom.query("[data-fee-id]"))return void(window.location.href="/cart");var n=this.config.settings.selectors.cart_subtotal?this.Dom.queryAll(this.config.settings.selectors.cart_subtotal):[this.Dom.find("cartSubtotal")];if(n.filter((t=>null==t?void 0:t.parentNode)).length)return;var c=null===(e=t.target)||void 0===e?void 0:e.parentNode;i||"cart"!==this.config.template_name||n.filter((t=>null==t?void 0:t.parentNode)).length||!c?r():this.updateHtml(c)}catch(t){console.error("⛔️ ".concat(a,": Cart validation error. err: ").concat(t)),r()}}}))}isFeeApplicable(t){var{clean_cart:e,customer_tags:r,geo_visitor:a}=this.config,{condition_type:i,conditions:n,geo_restriction:c,geo_is_reversed:o,type:s}=t;if(!function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t&&e.length){var a=["".concat(t.country,"_ALL"),"".concat(t.country,"_").concat(t.region_code||"ALL")].some((t=>e.includes(t)));return r?!a:a}return!0}(a,c,o))return{result:!1};var l={product_id:[],product_variant_id:[],product_type:[],product_tag:[],product_vendor:[],product_collection:[]};e.items.map((t=>{l.product_id=St(l.product_id,[String(t.product_id)]),l.product_variant_id=St(l.product_variant_id,[String(t.variant_id)]),l.product_type=St(l.product_type,[t.product_type]),l.product_tag=St(l.product_tag,e.tags[t.product_id]),l.product_vendor=St(l.product_vendor,[t.vendor]),l.product_collection=St(l.product_collection,e.collections[t.product_id])}));var d=e.items.map((t=>{var a={target_key:h(t),variant_id:t.variant_id};if(!n.length)return Object.assign(Object.assign({},a),{result:!0});var c={total_cart_qty:e.item_count,total_cart_price:e.total_price/100,total_cart_weight:e.total_weight,cart_line_item_qty:t.quantity,cart_line_item_price:t.line_price/100,product_weight:t.grams,product_price:t.price/100,product_id:[String(t.product_id)],product_variant_id:[String(t.variant_id)],product_type:[t.product_type],product_tag:e.tags[t.product_id],product_vendor:[t.vendor],product_collection:e.collections[t.product_id],customer_tag:r,product_title:t.title,product_sku:t.sku};return Object.assign(Object.assign({},a),{result:Lt(i,n,c,l,s)})}));return{result:d.some((t=>{var{result:e}=t;return!0===e})),items:d}}hideFeesProperties(){this.Dom.findAll("lineItemProperties").forEach((e=>{e.innerHTML.includes(t)&&e.classList.add("mw-hidden"),RegExp(/-mws-\d+/,"g").exec(e.innerHTML)&&(e.innerHTML=e.innerHTML.replace(/-mws-\d+/,""))})),this.config.settings.selectors.hidden_elements&&this.Dom.queryAll(this.config.settings.selectors.hidden_elements).forEach((t=>t.classList.add("mw-hidden")))}setCorrectCartCount(){if(this.config.settings.selectors.cart_count&&this.config.cart.item_count){var e=this.config.fees.filter((t=>{var{input_type:e}=t;return"HIDDEN"===e})).map((t=>{var{product_id:e}=t;return e})),r=this.config.fees.filter((t=>{var{options:e,clone_percent_fee:r}=t;return!r&&e.filter((t=>{var{price_type:e}=t;return"PERCENT"===e})).length})).map((t=>{var{product_id:e}=t;return e})),a=this.config.cart.items.reduce(((a,i)=>{var n=i.properties&&void 0!==i.properties[t]?i.properties[t]:{};return n&&e.includes(null==n?void 0:n.id)?a:n&&r.includes(null==n?void 0:n.id)?a+1:a+i.quantity}),0);this.Dom.queryAll(this.config.settings.selectors.cart_count).map((t=>{t.innerHTML=String(a)}))}}updateHtml(e){var{cart:r,fees:i,settings:{selectors:n,combined_hidden_fees:c,combined_hidden_fees_title:o}}=this.config,s=n.cart_line_item?this.Dom.queryAll(n.cart_line_item):this.Dom.findAll("lineItem");n.cart_line_item_filter&&(s=s.filter((t=>!this.Dom.queryAll(n.cart_line_item_filter,t).length)));var l=n.cart_subtotal?this.Dom.queryAll(n.cart_subtotal):[this.Dom.find("cartSubtotal")];!l.filter((t=>null==t?void 0:t.parentNode)).length&&e&&(l=[e]);var d=i.map((t=>{var{product_id:e}=t;return e})),p=r.items.filter((e=>{var r=e.properties?e.properties[t]:{};return r&&d.includes(parseInt(r.id,10))})).map((e=>{var r=e.properties?e.properties[t]:{};return r&&{product_id:parseInt(r.id,10),target_key:null==r?void 0:r.target_key}}));if(r.items.forEach(((e,r)=>{var c=e.properties?e.properties[t]:{};if(c){var o=parseInt(c.id,10),d=i.find((t=>t.product_id===o));if(d){if("HIDDEN"===d.input_type){var p="CART"===d.type?'[data-fee-id="'.concat(o,'"]'):'[data-fee-hidden-target-key="'.concat(c.target_key,'"][data-fee-id="').concat(o,'"]');for(var _ of l){var u=null==_?void 0:_.parentNode;if(u&&!this.Dom.query(p,u)){var f=this.Builder.create(d,c.target_key);u&&f?u.prepend(f):console.warn("🛠️ ".concat(a,": Cart subtotal container not found."))}}!this.Dom.queryAll('[data-fee-hidden-cart-line="'.concat(h(e),'"]')).length&&s.length&&(s[r].setAttribute("data-fee-hidden-cart-line",h(e)),s[r].classList.add("mw-hidden"))}if("HIDDEN"!==d.input_type&&s.length){var m=n.cart_line_item_qty?this.Dom.query(n.cart_line_item_qty,s[r]):this.Dom.find("lineItemQuantity",s[r]);if(null===m)return void console.warn("🛠️ ".concat(a,': Quantity input not found for cart item key: "').concat(h(e),'".'));m.disabled=!0;var v=m.parentElement;null==v||v.classList.add("mw-hidden")}}}})),c){var _=this.Dom.queryAll("[data-fee-hidden-calc-price]");if(_.length>1){var u=this.Builder.createCombinedFeeBlock(o,_);for(var f of l){var m=null==f?void 0:f.parentNode;if(m&&u){m.prepend(u);var v=this.Dom.query(".mw-fee--type-hidden");v&&v.classList.add("mw-hidden")}}}}i.filter((t=>"HIDDEN"!==t.input_type)).forEach((e=>{var i,n=this.isFeeApplicable(e);if(n.result){if("CART"===e.type){if(p.filter((t=>t.product_id===e.product_id)).length)return;var c=this.Builder.create(e);if(!c)return;for(var o of l){var d=null==o?void 0:o.parentNode;if(!d)return void console.warn("🛠️ ".concat(a,": Cart subtotal container not found."));this.Dom.query('[data-fee-id="'.concat(e.product_id,'"]'),d)||d.prepend(c)}}if("PRODUCT"===e.type&&s.length){var _=null===(i=n.items)||void 0===i?void 0:i.filter((t=>{var{result:e}=t;return!0===e})).map((t=>{var{variant_id:e}=t;return e}));if(!_)return void console.warn("🛠️ ".concat(a,": No items to apply fees to."));var u=_.map((t=>'a[href*="'.concat(t,'"]:not([aria-hidden="true"]), [data-fee-apply="').concat(t,'"]'))).join(", ");s.forEach(((a,i)=>{var n=r.items[i];if(!(n&&(null==n?void 0:n.properties)?n.properties[t]:void 0)&&(!p.filter((t=>t.product_id===e.product_id&&t.target_key===h(n))).length&&!a.querySelectorAll('[data-fee-id="'.concat(e.product_id,'"][data-fee-target-key="').concat(h(n),'"]')).length)){var c=this.Dom.queryAll(u,a);if(c.length){var o="A"===c[0].nodeName?c.filter((t=>null===this.Dom.query("img",t)))[0]:c[0];if(o){var s=this.Builder.create(e,h(n));s&&("A"===o.nodeName?o.insertAdjacentElement("afterend",s):o.replaceWith(s))}}}}))}}}))}attachEvents(){var{settings:t}=this.config;this.Cart.listen(this.updateCartData,t.ajax_timeout_interval);var e=t=>Ht(this,void 0,void 0,(function*(){yield this.validateCart(!1,t),yield this.applyHiddenFees(),this.config.multi_currency&&(yield this.multiCurrencyCart(window.Shopify.currency.active)),this.updateHtml(),this.hideFeesProperties(),this.setCorrectCartCount()})),r=t.selectors.checkout_btn?this.Dom.query(t.selectors.checkout_btn):null;r?r.addEventListener("click",(t=>{(()=>{Ht(this,void 0,void 0,(function*(){yield this.onCheckout(t)}))})()})):document.body.addEventListener("click",(t=>{(()=>{Ht(this,void 0,void 0,(function*(){("checkout"===t.target.getAttribute("name")||t.target.hasAttribute(F))&&(yield this.onCheckout(t))}))})()})),document.addEventListener(M,(()=>Ht(this,void 0,void 0,(function*(){yield e(M)})))),document.addEventListener(q,(()=>Ht(this,void 0,void 0,(function*(){yield e(q)})))),document.addEventListener(Q,(()=>Ht(this,void 0,void 0,(function*(){yield this.cartExec()})))),document.addEventListener(B,(()=>{this.Builder.hideOverlay()})),document.addEventListener(W,(()=>{this.config.fees=this.config.fees.filter((t=>!(t.clone_percent_fee&&t.options.filter((t=>"PERCENT"===t.price_type)).length))),console.warn("🛠️ ".concat(a,": Remove all percent fees to avoid recursive reloading page."))})),document.addEventListener(G,(()=>{this.updateHtml()}))}},Qt=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))};function Gt(t){return Qt(this,void 0,void 0,(function*(){var e=t.fees.filter((t=>"DATE"===t.input_type)),r=t.fees.filter((t=>""!==t.description));e.length&&!window.mwFeesFlatpickr&&(yield Qt(void 0,void 0,void 0,(function*(){return(yield i.e(958).then(i.bind(i,775))).default})).then((t=>{window.mwFeesFlatpickr=t}))),r.length&&!window.mwFeesTippy&&(yield Qt(void 0,void 0,void 0,(function*(){return(yield i.e(555).then(i.bind(i,239))).default})).then((t=>{window.mwFeesTippy=t,window.mwFeesTippy.setDefaultProps({theme:"light-border",interactive:!0,appendTo:document.body,allowHTML:!0})})))}))}var Xt=function(t,e,r,a){return new(r||(r=Promise))((function(i,n){function c(t){try{s(a.next(t))}catch(t){n(t)}}function o(t){try{s(a.throw(t))}catch(t){n(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((a=a.apply(t,e||[])).next())}))};!function(t,e){Xt(this,void 0,void 0,(function*(){void 0===t?void 0!==e&&void 0!==e.settings.selectors?(e.settings.ajax_timeout_interval=200,e.settings.force_not_reload_page=!1,yield Promise.all([Gt(e)]),e.fees=yield dt(e.fees),new Wt(e).init()):console.warn("🛑 ".concat(a,": config is missing or init metafield not found.")):console.warn("🛠️ ".concat(a," is already initialized."))}))}(window.mwFees,window.mwFeesConfig)})()})();
